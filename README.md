# Добро пожаловать в документацию по Docker

Документация будет разделена на разделы, которые описаны ниже:
1. Определения, теория
2. Команды, их объяснения

## Определения, теория
- **Docker** - сервис для запуска приложений в контейнерах.

Важно сказать, что Docker чаще всего используют с надстройкой Kubernetes, которая позволяет управлять
запуском разных контейнеров Docker на разных серверах.

**Почему стоит использовать Docker?**
- Приложения запускаются в **изолированной** среде (контейнер, в котором запускается приложение изолирован от других контейнеров и от внешней среды (компьютера, на котором запускается контейнер)). Тем самым, приложение внутри контейнера не зависит от того, что находится вне контейнера (от установленного софта на компьютере, например) 
- Легко запускать приложения на разных серверах
- Все зависимости приложений устанавливаются **внутри контейнеров**
- Легко масштабировать путём увеличения количества контейнеров
- Очень удобно использовать в процессе разработки приложений

Контейнеры создаются на компьютере, под управлением операционной системы Linux. У любой операционной системы 
Linux есть ядро (Linux Kernel), есть RAM (оперативная память), CPU (процессор), Network (сетевые ресурсы), Disk и **Docker Engine**.
**Docker Engine** - запускает сервис Docker (Docker Daemon), нужен для работы с контейнерами.

При создании контейнера, на компьютере создадутся файлы на диске (и файлы внутри этого контейнера будут доступны только
этому контейнеру). Далее запустится процесс, который будет обрабатываться ядром. Ядро у всех контейнеров общее (ядро хоста - о хосте будет сказано позже).
Все контейнеры и процессы внутри них изолированы друг от друга.
<br>
Чаще всего внутри одного контейнера запускается один процесс.

**Важно!** Если мы создаём несколько контейнеров с одного и того же образа, например Node JS, то у этих контейнеров 
будут определённые общие файлы, и эти общие файлы будут находиться на жёстком диске Docker хоста только в одном месте - 
они не будут скопированы n раз зависимо от количества контейнеров, запущенных на основании этого образа (тем самым ресурсы
используются более эффективно)

При остановке и удалении контейнера - все файлы созданные при работе контейнера удаляются. <br>
Docker автоматически останавливает те контейнеры, у которых нет активных процессов.

С одного образа можно создать множество контейнеров. Контейнер отличается от образа тем, что у него есть запущенные процессы (контейнеры работают и выполняют определённые задачи).
<br>
Информация о процессе, который запустится в контейнере, который создаётся на основании какого-то образа - находится в образе.

### Образ
Каждый образ состоит из слоёв. Слой состоит набора файлов. По английский слои называются FS layers (File System Layers).
<br>
У каждого образа есть базовый слой и другие слои, которые добавляются к базовому слою. 

**А зачем создавать множество слоёв?** Для того чтобы переиспользовать слои в разных образах. Тем самым может быть несколько
разных образов, у которых слои пересекаются (в таком случае в Docker хосте нет необходимости сохранять эти пересекающиеся
слои много раз). Базовый слой может быть сохранён в одном месте и Docker в процессе создания контейнера будет собирать его
с разных слоёв, которые указаны в определённом образе. Также, переиспользование слоёв ускоряет процесс создания
кастомных образов.

Например: я хочу создать образ на основании образа Node JS. Базовый слой Node JS в таком случае в моём образе будет переиспользован
из другого образа.
<br>
- Все слои в образе read-only
- Образы можно перемещать и удалять
- Образы хранятся в репозиториях (в одном репозитории может храниться несколько разных версий одного и того же образа (
- у каждой версии слой будет отличаться, но базовый слой обычно остаётся неизменным из версии в версию))
- Есть официальные образы и образы сообщества (в т. ч. приватные)

### Репозиторий
**Репозиторий** - это набор версий какого-то определённого образа. У каждой версии конкретного образа могут быть различные
теги. Одна версия образа может иметь несколько тегов.

### Команды Docker
- **docker version** - отображение текущей версии docker client, docker server (engine) (докер клиент и сервер независимы друг от друга, клиент может подключаться как к локальному, так и удалённому серверу)
- **docker ps** - показывает список запущенных контейнеров [-a: отобразит также остановленные контейнеры]
- **docker images** - показывает список локальных образов
- **docker run image_name** - Докер попытается найти такой образ локально. Если локально образ не будет найден - обратится к DockerHub (и будет скачан). Если образ найден - будет создан контейнер на основании указанного образа
- **docker rm container_id/container_name** - Удалит контейнер с указанным идентификатором/именем
- **docker hostname -i** - отобразит ip адрес контейнера
- **docker container prune** - удалит все неработающие контейнеры
- **docker container inspect container_id/container_name** - отобразит подробную информацию о контейнере
- **docker stop container_id/container_name** - останавливает контейнер с указанным ID/названием
- **docker exec -it container_id bash** - запустит дополнительный процесс в уже запущенном контейнере. В этом случае процессом будет bash в interactive terminal

### Опции команд
- **docker run -i -t container_name**/ **docker run -it container_name**** - i: interactive, -t: terminal
- **docker run -d container_name** - запустит контейнер в фоновом режиме (-d: detached)
- **docker container inspect container_id/container_name | grep IPAddress** - отобразит подробную информацию о контейнере выбрав только те поля, в которых встречается указанное слово после grep (на windows не работает)
- **docker run -d --name my_nginx** - с помощью параметра --name можно установить имя запускаемому контейнеру
- **docker run -p 8080:80 nginx** - запустит контейнер и опубликует порты [-p: публикация порта (8080:80 - значения слева от двоеточия - внешние порты, значения справа - порт контейнера)]
- **docker run -v ${PWD}:/usr/share/nginx/html nginx** - позволяет подключить том. (-v: volume) у volume есть параметр, слева от двоеточия указана директория на локальном компьютере, справа указана директория внутри контейнера (PWD - переменная, поддерживаемая всеми ОС. Она возвращает абсолютный путь к текущей папке)
- **docker run -it --rm container_name** - как только процесс в контейнере будет завершён и контейнер будет остановлен, он удалится

### Полезные команды
- ls - отобразит список файлов и директорий [-la: отобразит также скрытые файлы и папки]
- **docker stop container_name container_name2** - если использовать пробел, можно остановить все указанные контейнеры

Можно проверить есть ли у контейнера доступ в интернет с помощью ping. Внутри терминала в контейнере можно выполнить ping google.com например

Мы можем понять какой порт открыт у контейнера и по какому протоколу, ориентируясь на колонку PORTS при docker ps.

0.0.0.0 ip адрес означает что мы можем использовать любой доступный адрес (например localhost, 127.0.0.1)

С помощью мэппинга мы можем привязывать папки на компьютере к папкам внутри контейнера